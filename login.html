<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>æœƒå“¡ç™»å…¥ | éš±æ¹–å°ç«¹</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="background-images.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ç™»å…¥é é¢å°ˆç”¨æ¨£å¼ */
      body {
        background: #f8f9fa;
        margin: 0;
        padding: 0;
        font-family: "Noto Sans TC", sans-serif;
      }

      .login-container {
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .logo-section {
        text-align: center;
        margin: 20px 0;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .logo-placeholder {
        width: 240px;
        height: 240px;
        border-radius: 50%;
        margin: 0 auto 30px;
        display: block; /* æ”¹ç‚ºblockï¼Œé¿å…flexå¯èƒ½é€ æˆçš„å•é¡Œ */
        box-shadow: 0 8px 25px rgba(45, 90, 39, 0.3);
        border: 3px solid white; /* ç¨å¾®èª¿æ•´é‚Šæ¡†ï¼Œé…åˆæ‚¨çš„logoè¨­è¨ˆ */
        overflow: hidden; /* ç¢ºä¿åœ–ç‰‡ä¸æœƒè¶…å‡ºåœ“å½¢é‚Šç•Œ */
        background: #2d5a27; /* æ·±ç¶ è‰²èƒŒæ™¯ */
        position: relative; /* æ·»åŠ å®šä½ */
      }

      .logo-placeholder img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* æ”¹å›coverï¼Œç¢ºä¿åœ–ç‰‡å¡«æ»¿å®¹å™¨ */
        border-radius: 50%;
        background: #2d5a27; /* æ·±ç¶ è‰²èƒŒæ™¯ï¼Œé…åˆæ‚¨çš„logoè¨­è¨ˆ */
      }

      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        .logo-placeholder {
          width: 200px;
          height: 200px;
        }
      }

      @media (max-width: 480px) {
        .logo-placeholder {
          width: 160px;
          height: 160px;
        }
      }

      .login-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2d5a27;
        margin: 0 0 10px 0;
      }

      .login-subtitle {
        font-size: 1rem;
        color: #6c757d;
        margin: 0 0 30px 0;
        line-height: 1.5;
      }

      .form-section {
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-input {
        width: 100%;
        padding: 18px 20px;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        font-size: 1.1rem;
        background: white;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }

      .form-input:focus {
        outline: none;
        border-color: #2d5a27;
        box-shadow: 0 0 0 3px rgba(45, 90, 39, 0.1);
      }

      .separator {
        position: relative;
        text-align: center;
        margin: 30px 0;
      }

      .separator::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: #e9ecef;
      }

      .separator span {
        background: #f8f9fa;
        padding: 0 20px;
        color: #6c757d;
        font-size: 0.9rem;
      }

      .social-login {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 30px;
      }

      .social-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid #e9ecef;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.5rem;
        position: relative;
        overflow: hidden;
      }

      .social-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }

      .social-btn.google {
        background: linear-gradient(
          135deg,
          #4285f4 0%,
          #34a853 50%,
          #fbbc05 75%,
          #ea4335 100%
        );
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
      }

      .social-btn.google:hover {
        box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
      }

      .social-btn.facebook {
        background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(24, 119, 242, 0.3);
      }

      .social-btn.facebook:hover {
        box-shadow: 0 6px 20px rgba(24, 119, 242, 0.4);
      }

      .social-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .social-btn:hover::before {
        opacity: 1;
      }

      .social-icon {
        font-size: 1.8rem;
        font-weight: bold;
        position: relative;
        z-index: 1;
      }

      .login-btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #2d5a27 0%, #4a7c59 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(45, 90, 39, 0.3);
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(45, 90, 39, 0.4);
      }

      .register-section {
        text-align: center;
        margin-top: 25px;
      }

      .register-text {
        color: #6c757d;
        font-size: 0.95rem;
      }

      .register-text a {
        color: #2d5a27;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
      }

      .register-text a:hover {
        text-decoration: underline;
      }

      .error-message {
        color: #dc3545;
        text-align: center;
        margin: 15px 0;
        font-size: 0.9rem;
        padding: 10px;
        background: #f8d7da;
        border-radius: 8px;
        border: 1px solid #f5c6cb;
      }

      .success-message {
        color: #155724;
        text-align: center;
        margin: 15px 0;
        font-size: 0.9rem;
        padding: 10px;
        background: #d4edda;
        border-radius: 8px;
        border: 1px solid #c3e6cb;
      }

      /* éš±ç§ä¿è­·æé†’æ¨£å¼ */
      .privacy-notice {
        margin: 20px 0;
        padding: 15px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .privacy-notice-content h4 {
        color: #2d5a27;
        margin: 0 0 12px 0;
        font-size: 1rem;
        font-weight: 600;
      }

      .privacy-notice-content ul {
        margin: 0 0 12px 0;
        padding-left: 20px;
        color: #495057;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .privacy-notice-content li {
        margin-bottom: 6px;
      }

      .privacy-link {
        margin: 0;
        text-align: center;
      }

      .privacy-link a {
        color: #4a7c59;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .privacy-link a:hover {
        text-decoration: underline;
      }

      /* Google ç™»å…¥éš±ç§æ‰¿è«¾æ¨£å¼ */
      .google-privacy-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .google-privacy-modal.show {
        opacity: 1;
        visibility: visible;
      }

      .google-privacy-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 450px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: translateY(20px);
        transition: transform 0.3s ease;
      }

      .google-privacy-modal.show .google-privacy-content {
        transform: translateY(0);
      }

      .google-privacy-content h3 {
        color: #2d5a27;
        margin: 0 0 20px 0;
        font-size: 1.3rem;
        font-weight: 600;
      }

      .google-privacy-content .google-icon {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #4285f4;
      }

      .google-privacy-content p {
        color: #495057;
        margin: 0 0 20px 0;
        line-height: 1.6;
        font-size: 0.95rem;
      }

      .google-privacy-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .google-privacy-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 100px;
      }

      .google-privacy-btn.primary {
        background: #4285f4;
        color: white;
      }

      .google-privacy-btn.primary:hover {
        background: #3367d6;
        transform: translateY(-2px);
      }

      .google-privacy-btn.secondary {
        background: #f8f9fa;
        color: #495057;
        border: 1px solid #dee2e6;
      }

      .google-privacy-btn.secondary:hover {
        background: #e9ecef;
      }
    </style>
  </head>
  <body class="login-page">
    <div class="login-container">
      <!-- Logo å€åŸŸ -->
      <div class="logo-section">
        <div class="logo-placeholder">
          <img src="assets/logo.png" alt="éš±æ¹–å°ç«¹ Logo" />
        </div>
        <h1 class="login-title">æœƒå“¡ç™»å…¥</h1>
        <p class="login-subtitle" id="formSubtitle">è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶èˆ‡å¯†ç¢¼</p>

        <!-- éš±ç§ä¿è­·æé†’ -->
        <div class="privacy-notice" id="privacyNotice" style="display: none">
          <div class="privacy-notice-content">
            <h4>ğŸ”’ è³‡æ–™å®‰å…¨æ‰¿è«¾</h4>
            <ul>
              <li>
                æ‚¨çš„å€‹äººè³‡æ–™ä½¿ç”¨ Google Firebase å®‰å…¨å„²å­˜ï¼Œç¬¦åˆåœ‹éš›å®‰å…¨æ¨™æº–
              </li>
              <li>æ‰€æœ‰è³‡æ–™å‚³è¼¸éƒ½ç¶“é HTTPS åŠ å¯†ä¿è­·</li>
              <li>æˆ‘å€‘çµ•ä¸æœƒå°‡æ‚¨çš„è³‡æ–™å‡ºå”®æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹</li>
              <li>æ‚¨å¯ä»¥éš¨æ™‚åœ¨æœƒå“¡ä¸­å¿ƒæŸ¥çœ‹ã€ä¿®æ”¹æˆ–åˆªé™¤æ‚¨çš„è³‡æ–™</li>
            </ul>
            <p class="privacy-link">
              <a href="privacy-policy.html" target="_blank"
                >æŸ¥çœ‹å®Œæ•´éš±ç§æ¬Šæ”¿ç­–</a
              >
            </p>
          </div>
        </div>
      </div>

      <!-- ç™»å…¥è¡¨å–® -->
      <div id="loginForm" class="form-section">
        <div class="form-group">
          <input
            type="email"
            class="form-input"
            placeholder="é›»å­éƒµä»¶"
            id="loginEmail"
            required
          />
        </div>
        <div class="form-group">
          <input
            type="password"
            class="form-input"
            placeholder="å¯†ç¢¼"
            id="loginPassword"
            required
          />
        </div>
      </div>

      <!-- è¨»å†Šè¡¨å–® (é è¨­éš±è—) -->
      <div id="registerForm" class="form-section" style="display: none">
        <div class="form-group">
          <input
            type="text"
            class="form-input"
            placeholder="å§“å"
            id="registerName"
            required
          />
        </div>
        <div class="form-group">
          <input
            type="tel"
            class="form-input"
            placeholder="æ‰‹æ©Ÿè™Ÿç¢¼"
            id="registerPhone"
            maxlength="10"
            required
          />
        </div>
        <div class="form-group">
          <input
            type="email"
            class="form-input"
            placeholder="é›»å­éƒµä»¶"
            id="registerEmail"
            required
          />
        </div>
        <div class="form-group">
          <input
            type="password"
            class="form-input"
            placeholder="å¯†ç¢¼"
            id="registerPassword"
            required
          />
        </div>
      </div>

      <!-- ä¸»æŒ‰éˆ• -->
      <button class="login-btn" id="mainActionBtn">ç™»å…¥</button>

      <!-- åˆ†éš”ç·š -->
      <div class="separator">
        <span>æˆ–</span>
      </div>

      <!-- ç¤¾ç¾¤ç™»å…¥ -->
      <div class="social-login">
        <div class="social-btn google" id="googleLogin">
          <span class="social-icon">G</span>
        </div>
        <div class="social-btn facebook" id="facebookLogin">
          <span class="social-icon">f</span>
        </div>
      </div>

      <!-- åˆ‡æ›é€£çµ -->
      <div class="register-section">
        <p class="register-text">
          <span id="toggleText">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ</span>
          <a href="#" id="toggleLink">ç«‹å³è¨»å†Š</a>
        </p>
      </div>

      <!-- éŒ¯èª¤/æˆåŠŸè¨Šæ¯ -->
      <div id="errorMsg" class="error-message" style="display: none"></div>
      <div id="successMsg" class="success-message" style="display: none"></div>
    </div>

    <!-- Google ç™»å…¥éš±ç§æ‰¿è«¾æ¨¡æ…‹æ¡† -->
    <div id="googlePrivacyModal" class="google-privacy-modal">
      <div class="google-privacy-content">
        <div class="google-icon">ğŸ”’</div>
        <h3>Google ç™»å…¥éš±ç§æ‰¿è«¾</h3>
        <p>
          æˆ‘å€‘é‡è¦–æ‚¨çš„éš±ç§å®‰å…¨ã€‚ä½¿ç”¨ Google
          ç™»å…¥æ™‚ï¼Œæˆ‘å€‘åªæœƒå–å¾—æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼ˆå§“åã€é›»å­éƒµä»¶ï¼‰ï¼Œ ä¸¦ä½¿ç”¨ Google
          Firebase å®‰å…¨å„²å­˜ï¼Œç¬¦åˆåœ‹éš›å®‰å…¨æ¨™æº–ã€‚
        </p>
        <p>
          <strong>æˆ‘å€‘æ‰¿è«¾ï¼š</strong><br />
          â€¢ çµ•ä¸æœƒå°‡æ‚¨çš„è³‡æ–™å‡ºå”®æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹<br />
          â€¢ æ‰€æœ‰è³‡æ–™å‚³è¼¸éƒ½ç¶“é HTTPS åŠ å¯†ä¿è­·<br />
          â€¢ æ‚¨å¯ä»¥éš¨æ™‚åœ¨æœƒå“¡ä¸­å¿ƒç®¡ç†æ‚¨çš„è³‡æ–™
        </p>
        <div class="google-privacy-buttons">
          <button
            class="google-privacy-btn secondary"
            onclick="hideGooglePrivacyNotice()"
          >
            å–æ¶ˆ
          </button>
          <button
            class="google-privacy-btn primary"
            onclick="proceedWithGoogleLogin()"
          >
            åŒæ„ä¸¦ç¹¼çºŒ
          </button>
        </div>
      </div>
    </div>

    <!-- Facebook ç™»å…¥éš±ç§æ‰¿è«¾æ¨¡æ…‹æ¡† -->
    <div id="facebookPrivacyModal" class="google-privacy-modal">
      <div class="google-privacy-content">
        <div class="google-icon">ğŸ”’</div>
        <h3>Facebook ç™»å…¥éš±ç§æ‰¿è«¾</h3>
        <p>
          æˆ‘å€‘é‡è¦–æ‚¨çš„éš±ç§å®‰å…¨ã€‚ä½¿ç”¨ Facebook
          ç™»å…¥æ™‚ï¼Œæˆ‘å€‘åªæœƒå–å¾—æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼ˆå§“åã€é›»å­éƒµä»¶ï¼‰ï¼Œ ä¸¦ä½¿ç”¨ Google
          Firebase å®‰å…¨å„²å­˜ï¼Œç¬¦åˆåœ‹éš›å®‰å…¨æ¨™æº–ã€‚
        </p>
        <p>
          <strong>æˆ‘å€‘æ‰¿è«¾ï¼š</strong><br />
          â€¢ çµ•ä¸æœƒå°‡æ‚¨çš„è³‡æ–™å‡ºå”®æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹<br />
          â€¢ æ‰€æœ‰è³‡æ–™å‚³è¼¸éƒ½ç¶“é HTTPS åŠ å¯†ä¿è­·<br />
          â€¢ æ‚¨å¯ä»¥éš¨æ™‚åœ¨æœƒå“¡ä¸­å¿ƒç®¡ç†æ‚¨çš„è³‡æ–™
        </p>
        <div class="google-privacy-buttons">
          <button
            class="google-privacy-btn secondary"
            onclick="hideFacebookPrivacyNotice()"
          >
            å–æ¶ˆ
          </button>
          <button
            class="google-privacy-btn primary"
            onclick="proceedWithFacebookLogin()"
          >
            åŒæ„ä¸¦ç¹¼çºŒ
          </button>
        </div>
      </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/services/auth.service.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const mainActionBtn = document.getElementById("mainActionBtn");
        const toggleLink = document.getElementById("toggleLink");
        const toggleText = document.getElementById("toggleText");
        const formSubtitle = document.getElementById("formSubtitle");
        const loginTitle = document.querySelector(".login-title");

        const errorMsg = document.getElementById("errorMsg");
        const successMsg = document.getElementById("successMsg");

        let isLoginMode = true;

        // æª¢æŸ¥ URL åƒæ•¸ï¼Œå¦‚æœ action=signup å‰‡è‡ªå‹•åˆ‡æ›åˆ°è¨»å†Šæ¨¡å¼
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("action") === "signup") {
          isLoginMode = false;
          // è‡ªå‹•åˆ‡æ›åˆ°è¨»å†Šæ¨¡å¼
          loginTitle.textContent = "æœƒå“¡è¨»å†Š";
          formSubtitle.textContent = "è«‹å¡«å¯«ä»¥ä¸‹è³‡æ–™ä»¥å»ºç«‹å¸³æˆ¶";
          loginForm.style.display = "none";
          registerForm.style.display = "block";
          document.querySelector(".social-login").style.display = "none";
          document.querySelector(".separator").style.display = "none";
          mainActionBtn.textContent = "è¨»å†Š";
          toggleText.textContent = "å·²ç¶“æœ‰å¸³è™Ÿï¼Ÿ";
          toggleLink.textContent = "ç«‹å³ç™»å…¥";
          // é¡¯ç¤ºéš±ç§ä¿è­·æé†’
          document.getElementById("privacyNotice").style.display = "block";
        }

        toggleLink.addEventListener("click", (e) => {
          e.preventDefault();
          isLoginMode = !isLoginMode;

          if (isLoginMode) {
            loginTitle.textContent = "æœƒå“¡ç™»å…¥";
            formSubtitle.textContent = "è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶èˆ‡å¯†ç¢¼";
            loginForm.style.display = "block";
            registerForm.style.display = "none";
            document.querySelector(".social-login").style.display = "flex";
            document.querySelector(".separator").style.display = "block";
            mainActionBtn.textContent = "ç™»å…¥";
            toggleText.textContent = "é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ";
            toggleLink.textContent = "ç«‹å³è¨»å†Š";
            // éš±è—éš±ç§ä¿è­·æé†’
            document.getElementById("privacyNotice").style.display = "none";
          } else {
            loginTitle.textContent = "æœƒå“¡è¨»å†Š";
            formSubtitle.textContent = "è«‹å¡«å¯«ä»¥ä¸‹è³‡æ–™ä»¥å»ºç«‹å¸³æˆ¶";
            loginForm.style.display = "none";
            registerForm.style.display = "block";
            document.querySelector(".social-login").style.display = "none";
            document.querySelector(".separator").style.display = "none";
            mainActionBtn.textContent = "è¨»å†Š";
            toggleText.textContent = "å·²ç¶“æœ‰å¸³è™Ÿï¼Ÿ";
            toggleLink.textContent = "ç«‹å³ç™»å…¥";
            // é¡¯ç¤ºéš±ç§ä¿è­·æé†’
            document.getElementById("privacyNotice").style.display = "block";
          }
          errorMsg.style.display = "none";
          successMsg.style.display = "none";
        });

        mainActionBtn.addEventListener("click", async () => {
          errorMsg.style.display = "none";
          successMsg.style.display = "none";

          if (isLoginMode) {
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;

            if (!email || !password) {
              showError("è«‹å¡«å¯«é›»å­éƒµä»¶èˆ‡å¯†ç¢¼");
              return;
            }

            try {
              await AuthService.signIn(email, password);
              showSuccess("ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...");
              setTimeout(() => {
                window.location.href = "member.html";
              }, 1500);
            } catch (err) {
              console.error("ç™»å…¥å¤±æ•—:", err);
              showError("ç™»å…¥å¤±æ•—ï¼š" + err.message);
            }
          } else {
            const name = document.getElementById("registerName").value.trim();
            const phone = document.getElementById("registerPhone").value.trim();
            const email = document.getElementById("registerEmail").value.trim();
            const password = document.getElementById("registerPassword").value;

            if (!name || !phone || !email || !password) {
              showError("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½");
              return;
            }
            if (phone.length !== 10) {
              showError("è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆ10ä½æ•¸å­—ï¼‰");
              return;
            }
            if (password.length < 6) {
              showError("å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒ");
              return;
            }

            try {
              await AuthService.signUp(email, password, name, phone);
              const backupData = { name, phone, email };
              sessionStorage.setItem(
                "pending_user_data",
                JSON.stringify(backupData)
              );

              showSuccess("è¨»å†ŠæˆåŠŸï¼æ­£åœ¨è·³è½‰...");
              setTimeout(() => {
                window.location.href = "member.html";
              }, 1500);
            } catch (err) {
              console.error("è¨»å†Šå¤±æ•—:", err);
              showError("è¨»å†Šå¤±æ•—ï¼š" + err.message);
            }
          }
        });

        function showError(message) {
          errorMsg.textContent = message;
          errorMsg.style.display = "block";
        }

        function showSuccess(message) {
          successMsg.textContent = message;
          successMsg.style.display = "block";
        }

        // Google éš±ç§æ‰¿è«¾ç›¸é—œå‡½æ•¸
        function showGooglePrivacyNotice() {
          const modal = document.getElementById("googlePrivacyModal");
          modal.classList.add("show");

          // é»æ“Šå¤–éƒ¨é—œé–‰
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              hideGooglePrivacyNotice();
            }
          });
        }

        function hideGooglePrivacyNotice() {
          const modal = document.getElementById("googlePrivacyModal");
          modal.classList.remove("show");
        }

        async function proceedWithGoogleLogin() {
          try {
            hideGooglePrivacyNotice();
            showSuccess("æ­£åœ¨ä½¿ç”¨ Google ç™»å…¥...");
            await AuthService.signInWithGoogle();
            showSuccess("Google ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...");
            setTimeout(() => {
              window.location.href = "member.html";
            }, 1500);
          } catch (err) {
            console.error("Google ç™»å…¥å¤±æ•—:", err);
            showError("Google ç™»å…¥å¤±æ•—ï¼š" + err.message);
          }
        }

        // Facebook éš±ç§æ‰¿è«¾ç›¸é—œå‡½æ•¸
        function showFacebookPrivacyNotice() {
          const modal = document.getElementById("facebookPrivacyModal");
          modal.classList.add("show");

          // é»æ“Šå¤–éƒ¨é—œé–‰
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              hideFacebookPrivacyNotice();
            }
          });
        }

        function hideFacebookPrivacyNotice() {
          const modal = document.getElementById("facebookPrivacyModal");
          modal.classList.remove("show");
        }

        async function proceedWithFacebookLogin() {
          try {
            hideFacebookPrivacyNotice();
            showSuccess("æ­£åœ¨ä½¿ç”¨ Facebook ç™»å…¥...");
            await AuthService.signInWithFacebook();
            showSuccess("Facebook ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...");
            setTimeout(() => {
              window.location.href = "member.html";
            }, 1500);
          } catch (err) {
            console.error("Facebook ç™»å…¥å¤±æ•—:", err);
            showError("Facebook ç™»å…¥å¤±æ•—ï¼š" + err.message);
          }
        }

        // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸä½œç”¨åŸŸï¼Œè®“ HTML ä¸­çš„ onclick å¯ä»¥èª¿ç”¨
        window.hideGooglePrivacyNotice = hideGooglePrivacyNotice;
        window.proceedWithGoogleLogin = proceedWithGoogleLogin;
        window.hideFacebookPrivacyNotice = hideFacebookPrivacyNotice;
        window.proceedWithFacebookLogin = proceedWithFacebookLogin;

        document.getElementById("googleLogin").addEventListener("click", () => {
          // é¡¯ç¤º Google ç™»å…¥éš±ç§æ‰¿è«¾
          showGooglePrivacyNotice();
        });
        document
          .getElementById("facebookLogin")
          .addEventListener("click", () => {
            // é¡¯ç¤º Facebook ç™»å…¥éš±ç§æ‰¿è«¾
            showFacebookPrivacyNotice();
          });
        // é›»è©±è™Ÿç¢¼è‡ªå‹•æ ¼å¼åŒ–
        const phoneInput = document.getElementById("registerPhone");
        phoneInput.addEventListener("input", (e) => {
          let value = e.target.value.replace(/\D/g, "");
          if (value.length > 0) {
            value = value.replace(/(\d{4})(\d{3})(\d{3})/, "$1-$2-$3");
          }
          e.target.value = value;
        });
      });
    </script>
  </body>
</html>
