# Firebaseç´¢å¼•å„ªåŒ–æŒ‡å—

## ğŸ“Š **ç•¶å‰ç´¢å¼•ç‹€æ³åˆ†æ**

æ ¹æ“šæ‚¨çš„Firebaseç´¢å¼•æˆªåœ–ï¼Œä»¥ä¸‹æ˜¯ç•¶å‰ç´¢å¼•çš„è©³ç´°åˆ†æï¼š

### **Products é›†åˆç´¢å¼•**
1. `status` (â†‘), `createdAt` (â†“), `_name_` (â†“)
2. `status` (â†‘), `sortOrder` (â†‘), `_name_` (â†‘)  
3. `category` (â†‘), `sortOrder` (â†‘), `_name_` (â†‘)

### **Orders é›†åˆç´¢å¼•**
1. `uid` (â†‘), `createdAt` (â†“), `_name_` (â†“)
2. `status` (â†‘), `createdAt` (â†“), `_name_` (â†“)

### **Menu Items é›†åˆç´¢å¼•**
1. `category` (â†‘), `isAvailable` (â†‘), `sortOrder` (â†‘), `_name_` (â†‘)
2. `isAvailable` (â†‘), `sortOrder` (â†‘), `_name_` (â†‘)

### **Menu Featured é›†åˆç´¢å¼•**
1. `category` (â†‘), `isVisible` (â†‘), `order` (â†‘), `_name_` (â†‘)
2. `isVisible` (â†‘), `category` (â†‘), `order` (â†‘), `_name_` (â†‘)

## âœ… **é‡è¤‡ç´¢å¼•æ˜¯æ­£å¸¸çš„**

**é‡è¤‡çš„é›†åˆIDæ˜¯å®Œå…¨æ­£å¸¸çš„**ï¼Œé€™è¡¨ç¤ºï¼š
- åŒä¸€å€‹é›†åˆæœ‰å¤šå€‹ä¸åŒçš„è¤‡åˆç´¢å¼•
- æ¯å€‹ç´¢å¼•å°æ‡‰ä¸åŒçš„æŸ¥è©¢æ¨¡å¼
- é€™æ˜¯Firestoreçš„æœ€ä½³å¯¦è¸

## ğŸš€ **æ€§èƒ½å„ªåŒ–å»ºè­°**

### **1. æŸ¥è©¢å„ªåŒ–**
æˆ‘å·²ç¶“å„ªåŒ–äº†æ‚¨çš„ `getProducts` å‡½æ•¸ï¼Œç¾åœ¨å®ƒæœƒï¼š

```javascript
// å„ªå…ˆä½¿ç”¨æœå‹™å™¨ç«¯ç¯©é¸
if (status && status !== "all") {
  query = query.where("status", "==", status);
}

if (category && category !== "all") {
  query = query.where("category", "==", category);
}

// æ ¹æ“šç´¢å¼•é¸æ“‡åˆé©çš„æ’åº
if (status && status !== "all") {
  if (sortBy === "sortOrder") {
    query = query.orderBy("sortOrder", "asc");
  } else if (sortBy === "createdAt") {
    query = query.orderBy("createdAt", "desc");
  }
}
```

### **2. ç´¢å¼•ä½¿ç”¨ç­–ç•¥**

#### **Products æŸ¥è©¢æ¨¡å¼**
- **æŒ‰ç‹€æ…‹ç¯©é¸ + æ’åº**: ä½¿ç”¨ `status` + `sortOrder` ç´¢å¼•
- **æŒ‰ç‹€æ…‹ç¯©é¸ + æ™‚é–“æ’åº**: ä½¿ç”¨ `status` + `createdAt` ç´¢å¼•
- **æŒ‰åˆ†é¡ç¯©é¸ + æ’åº**: ä½¿ç”¨ `category` + `sortOrder` ç´¢å¼•

#### **Orders æŸ¥è©¢æ¨¡å¼**
- **æŒ‰ç”¨æˆ¶ç¯©é¸ + æ™‚é–“æ’åº**: ä½¿ç”¨ `uid` + `createdAt` ç´¢å¼•
- **æŒ‰ç‹€æ…‹ç¯©é¸ + æ™‚é–“æ’åº**: ä½¿ç”¨ `status` + `createdAt` ç´¢å¼•

### **3. å›é€€æ©Ÿåˆ¶**
ç•¶ç´¢å¼•ä¸åŒ¹é…æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å›é€€åˆ°å®¢æˆ¶ç«¯ç¯©é¸ï¼š

```javascript
catch (error) {
  if (error.code === 'failed-precondition' || error.code === 'unimplemented') {
    console.warn("ç´¢å¼•ä¸åŒ¹é…ï¼Œå›é€€åˆ°å®¢æˆ¶ç«¯ç¯©é¸æ¨¡å¼");
    return await getProductsFallback(options);
  }
  throw error;
}
```

## ğŸ“ˆ **æ€§èƒ½æå‡æ•ˆæœ**

### **å„ªåŒ–å‰ï¼ˆå®¢æˆ¶ç«¯ç¯©é¸ï¼‰**
- âŒ æ¯æ¬¡è¼‰å…¥æ‰€æœ‰å•†å“ï¼ˆå¯èƒ½æ•¸åƒå€‹ï¼‰
- âŒ æµªè²»å¸¶å¯¬
- âŒ å®¢æˆ¶ç«¯è™•ç†è² æ“”é‡
- âŒ éŸ¿æ‡‰æ™‚é–“æ…¢

### **å„ªåŒ–å¾Œï¼ˆæœå‹™å™¨ç«¯ç¯©é¸ï¼‰**
- âœ… åªè¼‰å…¥éœ€è¦çš„å•†å“
- âœ… ç¯€çœå¸¶å¯¬
- âœ… åˆ©ç”¨Firebaseç´¢å¼•å„ªåŒ–
- âœ… éŸ¿æ‡‰æ™‚é–“å¿«

## ğŸ”§ **ç´¢å¼•ç®¡ç†å»ºè­°**

### **1. ç›£æ§ç´¢å¼•ä½¿ç”¨**
```javascript
// åœ¨æŸ¥è©¢æ™‚è¨˜éŒ„ç´¢å¼•ä½¿ç”¨æƒ…æ³
console.log("ä½¿ç”¨ç´¢å¼•:", finalSortBy, finalSortOrder);
```

### **2. å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ç´¢å¼•**
- æª¢æŸ¥Firebaseæ§åˆ¶å°çš„ç´¢å¼•ä½¿ç”¨çµ±è¨ˆ
- åˆªé™¤é•·æ™‚é–“æœªä½¿ç”¨çš„ç´¢å¼•
- é¿å…éå¤šçš„ç´¢å¼•å½±éŸ¿å¯«å…¥æ€§èƒ½

### **3. æ–°å¢ç´¢å¼•æ™‚çš„æ³¨æ„äº‹é …**
- ç¢ºä¿ç´¢å¼•æ¬„ä½çš„é †åºèˆ‡æŸ¥è©¢é †åºä¸€è‡´
- è€ƒæ…®è¤‡åˆç´¢å¼•çš„æ¬„ä½é †åº
- æ¸¬è©¦ç´¢å¼•æ˜¯å¦æ­£ç¢ºåŒ¹é…æŸ¥è©¢

## ğŸš¨ **å¸¸è¦‹å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆ**

### **å•é¡Œ1: ç´¢å¼•ä¸åŒ¹é…éŒ¯èª¤**
```
Error: The query requires an index. You can create it here: ...
```

**è§£æ±ºæ–¹æ¡ˆ**: 
1. é»æ“ŠéŒ¯èª¤è¨Šæ¯ä¸­çš„é€£çµå‰µå»ºç´¢å¼•
2. ç­‰å¾…ç´¢å¼•å»ºç«‹å®Œæˆï¼ˆé€šå¸¸éœ€è¦å¹¾åˆ†é˜ï¼‰
3. é‡æ–°åŸ·è¡ŒæŸ¥è©¢

### **å•é¡Œ2: æŸ¥è©¢æ€§èƒ½æ…¢**
**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¢ºçš„ç´¢å¼•
2. æ¸›å°‘æŸ¥è©¢çµæœæ•¸é‡
3. ä½¿ç”¨åˆ†é æŸ¥è©¢

### **å•é¡Œ3: ç´¢å¼•å»ºç«‹å¤±æ•—**
**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ç´¢å¼•æ¬„ä½çš„æ•¸æ“šé¡å‹
2. ç¢ºä¿æ²’æœ‰é‡è¤‡çš„ç´¢å¼•
3. æª¢æŸ¥Firebaseé…é¡é™åˆ¶

## ğŸ“‹ **ç´¢å¼•æª¢æŸ¥æ¸…å–®**

### **Products é›†åˆ**
- [x] `status` + `sortOrder` ç´¢å¼•
- [x] `status` + `createdAt` ç´¢å¼•  
- [x] `category` + `sortOrder` ç´¢å¼•
- [ ] è€ƒæ…®æ·»åŠ  `price` ç›¸é—œç´¢å¼•ï¼ˆå¦‚æœéœ€è¦æŒ‰åƒ¹æ ¼ç¯©é¸ï¼‰

### **Orders é›†åˆ**
- [x] `uid` + `createdAt` ç´¢å¼•
- [x] `status` + `createdAt` ç´¢å¼•
- [ ] è€ƒæ…®æ·»åŠ  `paymentStatus` ç´¢å¼•ï¼ˆå¦‚æœéœ€è¦æŒ‰æ”¯ä»˜ç‹€æ…‹ç¯©é¸ï¼‰

### **Menu Items é›†åˆ**
- [x] `category` + `isAvailable` + `sortOrder` ç´¢å¼•
- [x] `isAvailable` + `sortOrder` ç´¢å¼•
- [ ] è€ƒæ…®æ·»åŠ  `price` ç´¢å¼•ï¼ˆå¦‚æœéœ€è¦æŒ‰åƒ¹æ ¼æ’åºï¼‰

## ğŸ¯ **æœ€ä½³å¯¦è¸**

1. **æŸ¥è©¢è¨­è¨ˆ**: è¨­è¨ˆæŸ¥è©¢æ™‚è€ƒæ…®ç´¢å¼•çµæ§‹
2. **ç´¢å¼•å„ªå…ˆ**: å„ªå…ˆä½¿ç”¨æœå‹™å™¨ç«¯ç¯©é¸å’Œæ’åº
3. **åˆ†é æŸ¥è©¢**: ä½¿ç”¨ `limit()` å’Œ `startAfter()` é€²è¡Œåˆ†é 
4. **éŒ¯èª¤è™•ç†**: å¯¦ç¾å›é€€æ©Ÿåˆ¶è™•ç†ç´¢å¼•éŒ¯èª¤
5. **ç›£æ§æ€§èƒ½**: å®šæœŸç›£æ§æŸ¥è©¢æ€§èƒ½å’Œä½¿ç”¨æƒ…æ³

## ğŸ“Š **æ€§èƒ½ç›£æ§**

å»ºè­°æ·»åŠ ä»¥ä¸‹ç›£æ§æŒ‡æ¨™ï¼š
- æŸ¥è©¢éŸ¿æ‡‰æ™‚é–“
- ç´¢å¼•ä½¿ç”¨ç‡
- å®¢æˆ¶ç«¯ç¯©é¸å›é€€æ¬¡æ•¸
- æ•¸æ“šå‚³è¼¸é‡

é€šéé€™äº›å„ªåŒ–ï¼Œæ‚¨çš„æ‡‰ç”¨å°‡ç²å¾—é¡¯è‘—çš„æ€§èƒ½æå‡ï¼ 