<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨é¢åŒæ­¥æ¸¬è©¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }

        .test-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .test-status {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-pending {
            background: #f39c12;
        }

        .status-success {
            background: #27ae60;
        }

        .status-error {
            background: #e74c3c;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .btn.primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn.success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            width: 0%;
        }

        .test-results {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .result-item {
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .result-success {
            color: #2ecc71;
        }

        .result-error {
            color: #e74c3c;
        }

        .result-warning {
            color: #f39c12;
        }

        .result-info {
            color: #3498db;
        }

        .product-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .product-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            margin-bottom: 5px;
            border-radius: 4px;
        }

        .product-order {
            background: #3498db;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .product-sort {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .product-comparison {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å…¨é¢åŒæ­¥æ¸¬è©¦</h1>
            <p>æ¸¬è©¦å•†å“æ’åºåŒæ­¥çš„æ‰€æœ‰åŠŸèƒ½å’Œé‚Šç•Œæƒ…æ³</p>
        </div>

        <div class="main-content">
            <div class="test-section">
                <h2>ğŸ“Š æ¸¬è©¦é€²åº¦</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="button-group">
                    <button class="btn primary" onclick="runAllTests()">ğŸš€ åŸ·è¡Œå…¨é¢æ¸¬è©¦</button>
                    <button class="btn warning" onclick="runQuickTest()">âš¡ å¿«é€Ÿæ¸¬è©¦</button>
                    <button class="btn danger" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
                </div>
            </div>

            <div class="test-section">
                <h2>ğŸ§ª æ¸¬è©¦é …ç›®</h2>
                <div class="test-grid">
                    <div class="test-card">
                        <h3>1. åŸºç¤é€£æ¥æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test1Status"></div>
                            <span>æ¸¬è©¦ Firebase é€£æ¥</span>
                        </div>
                        <button class="btn primary" onclick="testFirebaseConnection()">æ¸¬è©¦é€£æ¥</button>
                    </div>

                    <div class="test-card">
                        <h3>2. æ•¸æ“šè¼‰å…¥æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test2Status"></div>
                            <span>æ¸¬è©¦å•†å“æ•¸æ“šè¼‰å…¥</span>
                        </div>
                        <button class="btn primary" onclick="testDataLoading()">æ¸¬è©¦è¼‰å…¥</button>
                    </div>

                    <div class="test-card">
                        <h3>3. æ’åºé‚è¼¯æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test3Status"></div>
                            <span>æ¸¬è©¦æ’åºç®—æ³•</span>
                        </div>
                        <button class="btn primary" onclick="testSortingLogic()">æ¸¬è©¦æ’åº</button>
                    </div>

                    <div class="test-card">
                        <h3>4. åŒæ­¥ä¸€è‡´æ€§æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test4Status"></div>
                            <span>æ¸¬è©¦å…©é é¢åŒæ­¥</span>
                        </div>
                        <button class="btn primary" onclick="testSyncConsistency()">æ¸¬è©¦åŒæ­¥</button>
                    </div>

                    <div class="test-card">
                        <h3>5. é‚Šç•Œæƒ…æ³æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test5Status"></div>
                            <span>æ¸¬è©¦ç•°å¸¸æƒ…æ³</span>
                        </div>
                        <button class="btn primary" onclick="testEdgeCases()">æ¸¬è©¦é‚Šç•Œ</button>
                    </div>

                    <div class="test-card">
                        <h3>6. æ€§èƒ½æ¸¬è©¦</h3>
                        <div class="test-status">
                            <div class="status-indicator status-pending" id="test6Status"></div>
                            <span>æ¸¬è©¦è¼‰å…¥æ€§èƒ½</span>
                        </div>
                        <button class="btn primary" onclick="testPerformance()">æ¸¬è©¦æ€§èƒ½</button>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2>ğŸ“‹ å•†å“æ¯”è¼ƒ</h2>
                <div class="product-comparison">
                    <div>
                        <h3>å•†å“é é¢ (order.js)</h3>
                        <div class="product-list" id="orderPageList">
                            <div style="text-align: center; color: #666; padding: 20px;">
                                ç­‰å¾…æ¸¬è©¦...
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3>ç®¡ç†é é¢ (AdminProductService)</h3>
                        <div class="product-list" id="adminPageList">
                            <div style="text-align: center; color: #666; padding: 20px;">
                                ç­‰å¾…æ¸¬è©¦...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
                <div class="test-results" id="testResults">
                    <div class="result-item result-info">
                        å…¨é¢åŒæ­¥æ¸¬è©¦å·¥å…·å·²è¼‰å…¥...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <!-- æœ¬åœ°é…ç½®å’Œæœå‹™ -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/services/admin-product.service.js"></script>

    <script>
        let testResults = [];
        let orderPageProducts = [];
        let adminPageProducts = [];
        let testProgress = 0;

        function log(message, type = 'info') {
            const resultContainer = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `result-item result-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            resultContainer.appendChild(logEntry);
            resultContainer.scrollTop = resultContainer.scrollHeight;
        }

        function updateProgress(percent) {
            testProgress = percent;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function updateTestStatus(testId, status) {
            const statusElement = document.getElementById(`test${testId}Status`);
            statusElement.className = `status-indicator status-${status}`;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '<div class="result-item result-info">çµæœå·²æ¸…é™¤...</div>';
            testResults = [];
            updateProgress(0);
            
            // é‡ç½®æ‰€æœ‰æ¸¬è©¦ç‹€æ…‹
            for (let i = 1; i <= 6; i++) {
                updateTestStatus(i, 'pending');
            }
        }

        // æ¸¬è©¦1: Firebase é€£æ¥
        async function testFirebaseConnection() {
            try {
                updateTestStatus(1, 'pending');
                log('é–‹å§‹æ¸¬è©¦ Firebase é€£æ¥...', 'info');
                
                const db = firebase.firestore();
                const testDoc = await db.collection('_test').doc('connection').get();
                
                log('âœ… Firebase é€£æ¥æˆåŠŸ', 'success');
                updateTestStatus(1, 'success');
                return true;
                
            } catch (error) {
                log(`âŒ Firebase é€£æ¥å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(1, 'error');
                return false;
            }
        }

        // æ¸¬è©¦2: æ•¸æ“šè¼‰å…¥
        async function testDataLoading() {
            try {
                updateTestStatus(2, 'pending');
                log('é–‹å§‹æ¸¬è©¦æ•¸æ“šè¼‰å…¥...', 'info');
                
                // æ¸¬è©¦ order.js é‚è¼¯
                const db = firebase.firestore();
                const snapshot = await db.collection("products").get();
                
                orderPageProducts = [];
                snapshot.forEach((doc) => {
                    const productData = doc.data();
                    if (productData.status === "active") {
                        orderPageProducts.push({
                            id: doc.id,
                            ...productData,
                        });
                    }
                });

                orderPageProducts.sort((a, b) => {
                    const aValue = a.sortOrder || 999;
                    const bValue = b.sortOrder || 999;
                    return aValue - bValue;
                });

                // æ¸¬è©¦ AdminProductService
                const result = await AdminProductService.getProducts({
                    status: 'active',
                    sortBy: 'sortOrder',
                    sortOrder: 'asc'
                });
                adminPageProducts = result.products;

                log(`âœ… æ•¸æ“šè¼‰å…¥æˆåŠŸ: å•†å“é é¢ ${orderPageProducts.length} å€‹ï¼Œç®¡ç†é é¢ ${adminPageProducts.length} å€‹`, 'success');
                updateTestStatus(2, 'success');
                
                // æ›´æ–°å•†å“åˆ—è¡¨é¡¯ç¤º
                renderProductList('orderPageList', orderPageProducts);
                renderProductList('adminPageList', adminPageProducts);
                
                return true;
                
            } catch (error) {
                log(`âŒ æ•¸æ“šè¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(2, 'error');
                return false;
            }
        }

        // æ¸¬è©¦3: æ’åºé‚è¼¯
        async function testSortingLogic() {
            try {
                updateTestStatus(3, 'pending');
                log('é–‹å§‹æ¸¬è©¦æ’åºé‚è¼¯...', 'info');
                
                if (orderPageProducts.length === 0) {
                    await testDataLoading();
                }

                // æ¸¬è©¦æ’åºé‚è¼¯
                const testProducts = [
                    { name: 'A', sortOrder: 3 },
                    { name: 'B', sortOrder: 1 },
                    { name: 'C', sortOrder: 2 },
                    { name: 'D', sortOrder: null },
                    { name: 'E', sortOrder: undefined }
                ];

                const sorted = testProducts.sort((a, b) => {
                    const aValue = a.sortOrder || 999;
                    const bValue = b.sortOrder || 999;
                    return aValue - bValue;
                });

                const expectedOrder = ['B', 'C', 'A', 'D', 'E'];
                const actualOrder = sorted.map(p => p.name);
                
                if (JSON.stringify(actualOrder) === JSON.stringify(expectedOrder)) {
                    log('âœ… æ’åºé‚è¼¯æ­£ç¢º', 'success');
                } else {
                    log(`âŒ æ’åºé‚è¼¯éŒ¯èª¤: æœŸæœ› ${expectedOrder}, å¯¦éš› ${actualOrder}`, 'error');
                }

                // æ¸¬è©¦å¯¦éš›å•†å“æ’åº
                const isOrderPageSorted = isArraySorted(orderPageProducts, 'sortOrder');
                const isAdminPageSorted = isArraySorted(adminPageProducts, 'sortOrder');
                
                if (isOrderPageSorted && isAdminPageSorted) {
                    log('âœ… å¯¦éš›å•†å“æ’åºæ­£ç¢º', 'success');
                    updateTestStatus(3, 'success');
                    return true;
                } else {
                    log('âŒ å¯¦éš›å•†å“æ’åºæœ‰å•é¡Œ', 'error');
                    updateTestStatus(3, 'error');
                    return false;
                }
                
            } catch (error) {
                log(`âŒ æ’åºé‚è¼¯æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(3, 'error');
                return false;
            }
        }

        // æ¸¬è©¦4: åŒæ­¥ä¸€è‡´æ€§
        async function testSyncConsistency() {
            try {
                updateTestStatus(4, 'pending');
                log('é–‹å§‹æ¸¬è©¦åŒæ­¥ä¸€è‡´æ€§...', 'info');
                
                if (orderPageProducts.length === 0 || adminPageProducts.length === 0) {
                    await testDataLoading();
                }

                // æ¯”è¼ƒå•†å“æ•¸é‡
                if (orderPageProducts.length !== adminPageProducts.length) {
                    log(`âŒ å•†å“æ•¸é‡ä¸ä¸€è‡´: ${orderPageProducts.length} vs ${adminPageProducts.length}`, 'error');
                    updateTestStatus(4, 'error');
                    return false;
                }

                // æ¯”è¼ƒæ’åºé †åº
                let isConsistent = true;
                for (let i = 0; i < orderPageProducts.length; i++) {
                    const orderProduct = orderPageProducts[i];
                    const adminProduct = adminPageProducts[i];
                    
                    if (orderProduct.id !== adminProduct.id) {
                        log(`âŒ ç¬¬ ${i + 1} ä½å•†å“ä¸ä¸€è‡´: ${orderProduct.name} vs ${adminProduct.name}`, 'error');
                        isConsistent = false;
                    }
                }

                if (isConsistent) {
                    log('âœ… åŒæ­¥ä¸€è‡´æ€§æ¸¬è©¦é€šé', 'success');
                    updateTestStatus(4, 'success');
                    return true;
                } else {
                    updateTestStatus(4, 'error');
                    return false;
                }
                
            } catch (error) {
                log(`âŒ åŒæ­¥ä¸€è‡´æ€§æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(4, 'error');
                return false;
            }
        }

        // æ¸¬è©¦5: é‚Šç•Œæƒ…æ³
        async function testEdgeCases() {
            try {
                updateTestStatus(5, 'pending');
                log('é–‹å§‹æ¸¬è©¦é‚Šç•Œæƒ…æ³...', 'info');
                
                // æ¸¬è©¦ç©ºæ•¸æ“š
                const emptyResult = await AdminProductService.getProducts({
                    status: 'nonexistent',
                    sortBy: 'sortOrder',
                    sortOrder: 'asc'
                });
                
                if (emptyResult.products.length === 0) {
                    log('âœ… ç©ºæ•¸æ“šè™•ç†æ­£ç¢º', 'success');
                } else {
                    log('âŒ ç©ºæ•¸æ“šè™•ç†æœ‰å•é¡Œ', 'error');
                }

                // æ¸¬è©¦ç„¡æ•ˆæ’åºå­—æ®µ
                const invalidSortResult = await AdminProductService.getProducts({
                    status: 'active',
                    sortBy: 'nonexistent',
                    sortOrder: 'asc'
                });
                
                if (invalidSortResult.products.length > 0) {
                    log('âœ… ç„¡æ•ˆæ’åºå­—æ®µè™•ç†æ­£ç¢º', 'success');
                } else {
                    log('âŒ ç„¡æ•ˆæ’åºå­—æ®µè™•ç†æœ‰å•é¡Œ', 'error');
                }

                // æ¸¬è©¦å¤§é‡æ•¸æ“š
                const largeResult = await AdminProductService.getProducts({
                    status: 'active',
                    limit: 1000
                });
                
                log(`âœ… å¤§é‡æ•¸æ“šè™•ç†: ${largeResult.products.length} å€‹å•†å“`, 'success');
                updateTestStatus(5, 'success');
                return true;
                
            } catch (error) {
                log(`âŒ é‚Šç•Œæƒ…æ³æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(5, 'error');
                return false;
            }
        }

        // æ¸¬è©¦6: æ€§èƒ½æ¸¬è©¦
        async function testPerformance() {
            try {
                updateTestStatus(6, 'pending');
                log('é–‹å§‹æ€§èƒ½æ¸¬è©¦...', 'info');
                
                const startTime = Date.now();
                
                // æ¸¬è©¦ order.js é‚è¼¯æ€§èƒ½
                const orderStart = Date.now();
                const db = firebase.firestore();
                const snapshot = await db.collection("products").get();
                const orderEnd = Date.now();
                
                // æ¸¬è©¦ AdminProductService æ€§èƒ½
                const adminStart = Date.now();
                const result = await AdminProductService.getProducts({
                    status: 'active',
                    sortBy: 'sortOrder',
                    sortOrder: 'asc'
                });
                const adminEnd = Date.now();
                
                const totalTime = Date.now() - startTime;
                const orderTime = orderEnd - orderStart;
                const adminTime = adminEnd - adminStart;
                
                log(`âœ… æ€§èƒ½æ¸¬è©¦å®Œæˆ:`, 'success');
                log(`   ç¸½æ™‚é–“: ${totalTime}ms`, 'info');
                log(`   order.js: ${orderTime}ms`, 'info');
                log(`   AdminProductService: ${adminTime}ms`, 'info');
                
                if (totalTime < 5000) {
                    log('âœ… æ€§èƒ½è¡¨ç¾è‰¯å¥½', 'success');
                    updateTestStatus(6, 'success');
                    return true;
                } else {
                    log('âš ï¸ æ€§èƒ½è¼ƒæ…¢ï¼Œå»ºè­°å„ªåŒ–', 'warning');
                    updateTestStatus(6, 'error');
                    return false;
                }
                
            } catch (error) {
                log(`âŒ æ€§èƒ½æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateTestStatus(6, 'error');
                return false;
            }
        }

        // è¼”åŠ©å‡½æ•¸
        function isArraySorted(array, key) {
            for (let i = 1; i < array.length; i++) {
                const prev = array[i - 1][key] || 999;
                const curr = array[i][key] || 999;
                if (prev > curr) return false;
            }
            return true;
        }

        function renderProductList(containerId, products) {
            const container = document.getElementById(containerId);
            
            if (products.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">æ²’æœ‰å•†å“æ•¸æ“š</div>';
                return;
            }

            const productsHTML = products.slice(0, 10).map((product, index) => `
                <div class="product-item">
                    <div class="product-order">${index + 1}</div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                    </div>
                    <div class="product-sort">${product.sortOrder || 999}</div>
                </div>
            `).join('');

            container.innerHTML = productsHTML;
        }

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        async function runAllTests() {
            log('ğŸš€ é–‹å§‹åŸ·è¡Œå…¨é¢æ¸¬è©¦...', 'info');
            updateProgress(0);
            
            const tests = [
                { name: 'Firebase é€£æ¥', func: testFirebaseConnection },
                { name: 'æ•¸æ“šè¼‰å…¥', func: testDataLoading },
                { name: 'æ’åºé‚è¼¯', func: testSortingLogic },
                { name: 'åŒæ­¥ä¸€è‡´æ€§', func: testSyncConsistency },
                { name: 'é‚Šç•Œæƒ…æ³', func: testEdgeCases },
                { name: 'æ€§èƒ½æ¸¬è©¦', func: testPerformance }
            ];

            let passedTests = 0;
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                log(`åŸ·è¡Œæ¸¬è©¦ ${i + 1}: ${test.name}`, 'info');
                
                try {
                    const result = await test.func();
                    if (result) passedTests++;
                } catch (error) {
                    log(`æ¸¬è©¦ ${test.name} åŸ·è¡Œå¤±æ•—: ${error.message}`, 'error');
                }
                
                updateProgress(((i + 1) / tests.length) * 100);
            }

            const successRate = (passedTests / tests.length) * 100;
            log(`ğŸ‰ æ¸¬è©¦å®Œæˆ! é€šéç‡: ${successRate.toFixed(1)}% (${passedTests}/${tests.length})`, 'success');
            
            if (successRate === 100) {
                log('âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼Œç³»çµ±é‹è¡Œæ­£å¸¸ï¼', 'success');
            } else {
                log('âš ï¸ éƒ¨åˆ†æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç›¸é—œåŠŸèƒ½', 'warning');
            }
        }

        // å¿«é€Ÿæ¸¬è©¦
        async function runQuickTest() {
            log('âš¡ é–‹å§‹å¿«é€Ÿæ¸¬è©¦...', 'info');
            updateProgress(0);
            
            const quickTests = [
                { name: 'Firebase é€£æ¥', func: testFirebaseConnection },
                { name: 'æ•¸æ“šè¼‰å…¥', func: testDataLoading },
                { name: 'åŒæ­¥ä¸€è‡´æ€§', func: testSyncConsistency }
            ];

            let passedTests = 0;
            
            for (let i = 0; i < quickTests.length; i++) {
                const test = quickTests[i];
                log(`å¿«é€Ÿæ¸¬è©¦ ${i + 1}: ${test.name}`, 'info');
                
                try {
                    const result = await test.func();
                    if (result) passedTests++;
                } catch (error) {
                    log(`å¿«é€Ÿæ¸¬è©¦ ${test.name} å¤±æ•—: ${error.message}`, 'error');
                }
                
                updateProgress(((i + 1) / quickTests.length) * 100);
            }

            const successRate = (passedTests / quickTests.length) * 100;
            log(`âš¡ å¿«é€Ÿæ¸¬è©¦å®Œæˆ! é€šéç‡: ${successRate.toFixed(1)}% (${passedTests}/${quickTests.length})`, 'success');
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('å…¨é¢åŒæ­¥æ¸¬è©¦å·¥å…·å·²è¼‰å…¥', 'info');
            log('æº–å‚™æ¸¬è©¦å•†å“æ’åºåŒæ­¥åŠŸèƒ½...', 'info');
        });
    </script>
</body>
</html> 