<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“æ’åºåŒæ­¥æ¸¬è©¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .sync-status {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .status-value {
            font-weight: bold;
        }

        .status-value.success {
            color: #27ae60;
        }

        .status-value.warning {
            color: #f39c12;
        }

        .status-value.error {
            color: #e74c3c;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn.success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .product-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            margin-bottom: 8px;
            border-radius: 5px;
        }

        .product-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .product-order {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .product-details {
            font-size: 0.9em;
            color: #666;
        }

        .product-sort {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert.info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert.warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert.danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .comparison-result {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å•†å“æ’åºåŒæ­¥æ¸¬è©¦</h1>
            <p>é©—è­‰å•†å“é é¢å’Œå•†å“ç®¡ç†é é¢çš„æ’åºä¸€è‡´æ€§</p>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“¦ å•†å“é é¢æ’åº</h2>
                <div class="sync-status">
                    <div class="status-item">
                        <span class="status-label">æ•¸æ“šä¾†æº</span>
                        <span class="status-value">order.js</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ’åºå­—æ®µ</span>
                        <span class="status-value">sortOrder</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ’åºæ–¹å‘</span>
                        <span class="status-value">å‡åº (asc)</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å•†å“æ•¸é‡</span>
                        <span class="status-value" id="orderPageCount">è¼‰å…¥ä¸­...</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn primary" onclick="loadOrderPageProducts()">ğŸ”„ è¼‰å…¥å•†å“é é¢æ•¸æ“š</button>
                    <button class="btn success" onclick="createTestProduct()">â• å‰µå»ºæ¸¬è©¦å•†å“</button>
                </div>

                <div class="product-list" id="orderPageProducts">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        é»æ“Šã€Œè¼‰å…¥å•†å“é é¢æ•¸æ“šã€é–‹å§‹æ¸¬è©¦
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>âš™ï¸ å•†å“ç®¡ç†é é¢æ’åº</h2>
                <div class="sync-status">
                    <div class="status-item">
                        <span class="status-label">æ•¸æ“šä¾†æº</span>
                        <span class="status-value">AdminProductService</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ’åºå­—æ®µ</span>
                        <span class="status-value">sortOrder</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ’åºæ–¹å‘</span>
                        <span class="status-value">å‡åº (asc)</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å•†å“æ•¸é‡</span>
                        <span class="status-value" id="adminPageCount">è¼‰å…¥ä¸­...</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn primary" onclick="loadAdminPageProducts()">ğŸ”„ è¼‰å…¥ç®¡ç†é é¢æ•¸æ“š</button>
                    <button class="btn warning" onclick="testSortSync()">ğŸ” æ¸¬è©¦æ’åºåŒæ­¥</button>
                </div>

                <div class="product-list" id="adminPageProducts">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        é»æ“Šã€Œè¼‰å…¥ç®¡ç†é é¢æ•¸æ“šã€é–‹å§‹æ¸¬è©¦
                    </div>
                </div>
            </div>

            <div class="panel full-width">
                <h2>ğŸ“Š åŒæ­¥æ¸¬è©¦çµæœ</h2>
                <div class="alert info">
                    <strong>æ¸¬è©¦èªªæ˜ï¼š</strong> æ­¤é é¢ç”¨æ–¼é©—è­‰å•†å“é é¢ï¼ˆorder.jsï¼‰å’Œå•†å“ç®¡ç†é é¢ï¼ˆAdminProductServiceï¼‰çš„æ’åºæ˜¯å¦å®Œå…¨ä¸€è‡´ã€‚å…©å€‹é é¢éƒ½æ‡‰è©²ä½¿ç”¨ç›¸åŒçš„ sortOrder å­—æ®µé€²è¡Œå‡åºæ’åˆ—ã€‚
                </div>
                <div class="comparison-result" id="comparisonResult">
                    <div style="color: #3498db;">
                        ç­‰å¾…æ¸¬è©¦çµæœ...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <!-- æœ¬åœ°é…ç½®å’Œæœå‹™ -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/services/admin-product.service.js"></script>

    <script>
        let orderPageProducts = [];
        let adminPageProducts = [];

        function log(message, type = 'info') {
            const resultContainer = document.getElementById('comparisonResult');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#e74c3c' : 
                                  type === 'success' ? '#2ecc71' : 
                                  type === 'warning' ? '#f39c12' : '#3498db';
            logEntry.textContent = `[${timestamp}] ${message}`;
            resultContainer.appendChild(logEntry);
            resultContainer.scrollTop = resultContainer.scrollHeight;
        }

        // æ¨¡æ“¬ order.js çš„è¼‰å…¥é‚è¼¯
        async function loadOrderPageProducts() {
            try {
                log('é–‹å§‹è¼‰å…¥å•†å“é é¢æ•¸æ“šï¼ˆæ¨¡æ“¬ order.jsï¼‰...', 'info');
                
                const db = firebase.firestore();
                const snapshot = await db.collection("products").get();

                orderPageProducts = [];
                snapshot.forEach((doc) => {
                    const productData = doc.data();
                    // åªè¼‰å…¥ä¸Šæ¶çš„å•†å“
                    if (productData.status === "active") {
                        orderPageProducts.push({
                            id: doc.id,
                            ...productData,
                        });
                    }
                });

                // å®¢æˆ¶ç«¯æ’åºï¼Œèˆ‡ AdminProductService ä¿æŒä¸€è‡´
                orderPageProducts.sort((a, b) => {
                    const aValue = a.sortOrder || 999;
                    const bValue = b.sortOrder || 999;
                    return aValue - bValue; // å‡åºæ’åˆ—
                });

                document.getElementById('orderPageCount').textContent = orderPageProducts.length;
                renderProductList('orderPageProducts', orderPageProducts);
                log(`å•†å“é é¢è¼‰å…¥å®Œæˆ: ${orderPageProducts.length} å€‹å•†å“`, 'success');
                
            } catch (error) {
                log(`å•†å“é é¢è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // è¼‰å…¥ç®¡ç†é é¢æ•¸æ“š
        async function loadAdminPageProducts() {
            try {
                log('é–‹å§‹è¼‰å…¥ç®¡ç†é é¢æ•¸æ“šï¼ˆAdminProductServiceï¼‰...', 'info');
                
                const result = await AdminProductService.getProducts({
                    status: 'active',
                    sortBy: 'sortOrder',
                    sortOrder: 'asc'
                });

                adminPageProducts = result.products;
                document.getElementById('adminPageCount').textContent = adminPageProducts.length;
                renderProductList('adminPageProducts', adminPageProducts);
                log(`ç®¡ç†é é¢è¼‰å…¥å®Œæˆ: ${adminPageProducts.length} å€‹å•†å“`, 'success');
                
            } catch (error) {
                log(`ç®¡ç†é é¢è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸²æŸ“å•†å“åˆ—è¡¨
        function renderProductList(containerId, products) {
            const container = document.getElementById(containerId);
            
            if (products.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">æ²’æœ‰å•†å“æ•¸æ“š</div>';
                return;
            }

            const productsHTML = products.map((product, index) => `
                <div class="product-item">
                    <div class="product-order">${index + 1}</div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-details">
                            åƒ¹æ ¼: NT$ ${product.price} | åˆ†é¡: ${product.category || 'æœªåˆ†é¡'}
                        </div>
                    </div>
                    <div class="product-sort">${product.sortOrder || 999}</div>
                </div>
            `).join('');

            container.innerHTML = productsHTML;
        }

        // æ¸¬è©¦æ’åºåŒæ­¥
        function testSortSync() {
            if (orderPageProducts.length === 0 || adminPageProducts.length === 0) {
                log('è«‹å…ˆè¼‰å…¥å…©å€‹é é¢çš„æ•¸æ“š', 'warning');
                return;
            }

            log('é–‹å§‹æ¸¬è©¦æ’åºåŒæ­¥...', 'info');
            
            // æ¯”è¼ƒå•†å“æ•¸é‡
            if (orderPageProducts.length !== adminPageProducts.length) {
                log(`âŒ å•†å“æ•¸é‡ä¸ä¸€è‡´: å•†å“é é¢ ${orderPageProducts.length} å€‹ï¼Œç®¡ç†é é¢ ${adminPageProducts.length} å€‹`, 'error');
                return;
            }

            // æ¯”è¼ƒæ’åºé †åº
            let isSync = true;
            for (let i = 0; i < orderPageProducts.length; i++) {
                const orderProduct = orderPageProducts[i];
                const adminProduct = adminPageProducts[i];
                
                if (orderProduct.id !== adminProduct.id) {
                    log(`âŒ ç¬¬ ${i + 1} ä½å•†å“ä¸ä¸€è‡´:`, 'error');
                    log(`   å•†å“é é¢: ${orderProduct.name} (ID: ${orderProduct.id}, sortOrder: ${orderProduct.sortOrder})`, 'error');
                    log(`   ç®¡ç†é é¢: ${adminProduct.name} (ID: ${adminProduct.id}, sortOrder: ${adminProduct.sortOrder})`, 'error');
                    isSync = false;
                }
            }

            if (isSync) {
                log('âœ… æ’åºå®Œå…¨åŒæ­¥ï¼å…©å€‹é é¢çš„å•†å“é †åºå®Œå…¨ä¸€è‡´', 'success');
                log(`ğŸ“Š ç¸½å…± ${orderPageProducts.length} å€‹å•†å“ï¼Œæ’åºé †åº:`, 'info');
                orderPageProducts.forEach((product, index) => {
                    log(`   ${index + 1}. ${product.name} (sortOrder: ${product.sortOrder})`, 'info');
                });
            } else {
                log('âŒ æ’åºä¸åŒæ­¥ï¼Œè«‹æª¢æŸ¥æ’åºé‚è¼¯', 'error');
            }
        }

        // å‰µå»ºæ¸¬è©¦å•†å“
        async function createTestProduct() {
            try {
                log('å‰µå»ºæ¸¬è©¦å•†å“...', 'info');
                
                const testProduct = {
                    name: `æ¸¬è©¦å•†å“_${Date.now()}`,
                    price: Math.floor(Math.random() * 500) + 100,
                    category: 'æ¸¬è©¦åˆ†é¡',
                    description: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦å•†å“',
                    status: 'active',
                    sortOrder: Math.floor(Math.random() * 100) + 1,
                    stock: Math.floor(Math.random() * 50) + 10
                };
                
                const result = await AdminProductService.createProduct(testProduct);
                log(`æ¸¬è©¦å•†å“å‰µå»ºæˆåŠŸ: ${result.name} (sortOrder: ${result.sortOrder})`, 'success');
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                await loadOrderPageProducts();
                await loadAdminPageProducts();
                
            } catch (error) {
                log(`å‰µå»ºæ¸¬è©¦å•†å“å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        window.addEventListener('load', () => {
            log('å•†å“æ’åºåŒæ­¥æ¸¬è©¦å·¥å…·å·²è¼‰å…¥', 'info');
            log('å•†å“é é¢: order.js â†’ å®¢æˆ¶ç«¯æ’åº (sortOrder asc)', 'info');
            log('ç®¡ç†é é¢: AdminProductService â†’ å®¢æˆ¶ç«¯æ’åº (sortOrder asc)', 'info');
            log('å…©å€‹é é¢æ‡‰è©²å®Œå…¨åŒæ­¥', 'success');
        });
    </script>
</body>
</html> 